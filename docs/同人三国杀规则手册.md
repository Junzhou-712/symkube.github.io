# 同人三国杀规则手册
此手册为开发三国杀相关程序而撰写，旨在以开发者的视角去构建游戏规则的逻辑体系。

## 整体架构

### game
game类中定义了最顶层的默认规则，如注册效果，牌的处理顺序，事件的插入等级。也维护了各种常用信息。  
各种操作需要向game注册可用事件集合。  
~~game维护“等待操作”事件，“等待操作”事件暂不作为event。~~  
game实际上在维护支持任意位置插入的event链表。将来可以尝试搞成分块链表来保证极端情况下的效率。  
double：EventsPriorityBrackets() 用于濒死结算，生成一个“事件的优先级括号”。  

### universe
universe定义了本局游戏的“全集”，用于“当作任意锦囊牌使用”、“视为使用任意基本牌”等技能。

### round
round类对应了回合。感觉不需要对轮次做封装。  
可以为进入回合时注册event  
声明函数  
bool:isRoutineRound()  是否为常规回合（由基础规则提供的）  
player：RoundPlayer  

### parse
parse类对应了阶段。~~感觉不需要对回合、轮次做封装，都放在game就好。~~

### event
event类对应了事件。“等待玩家进行操作”也是一个event
double：Priority


### player
player类对应了进行操作的玩家

### entity
entity类对应了游戏中的具体图标或实体桌游中的各种卡牌、token的列表。默认为有序列表，但可以定义为无序。大部分操作可以。由entity类继承常见的charactor、cardlist、card类。

### charactor
charactor类对应了武将卡

### cardlist
cardlist类对应了卡片组

### card
card类对应单张卡片

### math
math类保存辅助用数学函数

## 游戏流程
使用数据结构来描述准确游戏的结构。  

game注册环形的回合链表，从startplayer开始，使用defaultdirect迭代器进行预先声明。但是尽量使用game中的迭代器做跨回合的操作，不要直接调用预声明的回合。  
round类的注册生成parse。


